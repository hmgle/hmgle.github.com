--- 
layout: post
title: "\xE7\x94\xA8C\xE8\xAF\xAD\xE8\xA8\x80\xE6\x94\xB9\xE5\x86\x99\xE5\xB9\xB3\xE9\x9D\xA2\xE5\x88\x9A\xE6\x9E\xB6\xE9\x9D\x99\xE5\x8A\x9B\xE5\x88\x86\xE6\x9E\x90\xE7\xA8\x8B\xE5\xBA\x8F\xEF\xBC\x88\xE4\xB8\x80\xEF\xBC\x89"
categories: 
- "\xE6\xB5\x81\xE5\x85\xA5"
- "\xE9\x80\x90\xE6\xB5\xAA"
tags: 
- C/C++
- Fortran
- "\xE7\xA8\x8B\xE5\xBA\x8F"
status: publish
type: post
published: true
meta: 
  _edit_last: "1"
---
几乎用了整个国庆假期，用C改写了李鲲廉主编的结构力学（第4版）上册附录的pf程序，原pf程序是

用FORTRAN 77写的。期间参考了FORTRAN    90程序设计教程（刘卫国主编）、c程序设计（谭浩强著）、数

值计算方法与c语言工程函数库（杨华中 汪蕙编）p13~p17、结构矩阵分析与程序设计（温瑞监主编）等书

籍。本打算解方程组自己设计算法，难度大，故继续沿用原程序采用的变带宽LDLT法（改进平方根法）。

程序功能基本保持不变。不考虑异常处理功能，不考虑界面，必须按格式正确输入数据，数据输入错误时

可能不能运行。调试时出现了非常奇怪的问题，对于存在链杆支座的结构可能得出错误的答案，原因目前

不明，郁闷中。使用步骤和原来的一样，见李编的结构力学附录。下面是该书p357上的一个算例：杆件截

面为矩形，柱截面宽0.4m，高0.4m；梁截面宽0.4m，高0.7m（如图）：
<a href="http://hmgle.org/wp-content/uploads/2007/10/frame.jpg"><img class="alignnone size-full wp-image-301" title="frame" src="http://hmgle.org/wp-content/uploads/2007/10/frame.jpg" alt="" width="321" height="357" /></a>
<div></div>
选用弹性模量355e6gpa，求出各截面面积及二次矩，划分好节点和杆件号，输入数据文件内容：

*****************************************************

*                                                     *

*    算例 21:31 2007-10-8                               *

*                                                     *

*****************************************************

355e5 9 8 6 1

1 2 0.28 114333e-7

1 3 0.16 213333e-8

2 4 0.16 213333e-8

3 4 0.28 114333e-7

3 5 0.16 213333e-8

4 6 0.16 213333e-8

5 6 0.28 114333e-7

5 7 0.16 213333e-8

6 8 0.16 213333e-8

0 11

6 11

0 7.5

6 7.5

0 4

6 4

0 0

6 0

71 0

72 0

73 0

81 0

82 0

83 0

0

3

2 3 20 3.5

5 3 20 3.5

8 3 20 4

用我改写的程序算，输出结果文件为：

Input Data File Name:suanli.txt

Output File Name:suanliout.txt

*****************************************************

*                                                     *

*    算例 21:31 2007-10-8                               *

*                                                     *

*****************************************************

The Input Data

The General Information

E           NM       NJ       NS       NLC

3.550e+007        9        8        6        1

The Information of Members

member    start    end           A                 I

1         1       2     2.800000e-001     1.143330e-002

2         1       3     1.600000e-001     2.133330e-003

3         2       4     1.600000e-001     2.133330e-003

4         3       4     2.800000e-001     1.143330e-002

5         3       5     1.600000e-001     2.133330e-003

6         4       6     1.600000e-001     2.133330e-003

7         5       6     2.800000e-001     1.143330e-002

8         5       7     1.600000e-001     2.133330e-003

9         6       8     1.600000e-001     2.133330e-003

The joint Coordinates

joint          X                 Y

1          0.000000         11.000000

2          6.000000         11.000000

3          0.000000          7.500000

4          6.000000          7.500000

5          0.000000          4.000000

6          6.000000          4.000000

7          0.000000          0.000000

8          6.000000          0.000000

The Information of Supports

IS          VS

71         0.000000

72         0.000000

73         0.000000

81         0.000000

82         0.000000

83         0.000000

Loading Case    1

The Loadings at Joints

NLJ=     0

The Loadings at Members

NLM=     3

membet    type           VF                DST

2        3          20.000000          3.500000

5        3          20.000000          3.500000

8        3          20.000000          4.000000

The Results of Calculation

The Joint Displacements

joint          u                 v              rotation

1     1.340429e-002     5.846036e-005    -4.615768e-005

2     1.339457e-002    -1.297632e-004    -1.431599e-004

3     1.182718e-002     7.475106e-005    -3.457760e-004

4     1.180527e-002    -1.244870e-004    -3.307285e-004

5     7.634272e-003     6.561075e-005    -6.319532e-004

6     7.611849e-003    -9.377977e-005    -6.530693e-004

7     9.045905e-021     9.316727e-021    -1.928831e-020

8     8.954095e-021    -1.331673e-020    -1.914467e-020

The Terminal Forces

member                    FN                FS                  M

1    start     1         16.109058         -8.562519          -19.125643

end     2        -16.109058          8.562519          -32.249471

2    start     1         -8.562519        -16.109058           19.125643

end     3          8.562519        -53.890942           46.992656

3    start     2          8.562519         16.109058           32.249471

end     4         -8.562519        -16.109058           24.132231

4    start     3         36.283916        -41.270895         -124.830605

end     4        -36.283916         41.270895         -122.794767

5    start     3        -49.833414         17.607026           77.837950

end     5         49.833414        -87.607026          106.286642

6    start     4         49.833414         52.392974           98.662536

end     6        -49.833414        -52.392974           84.712873

7    start     5         37.147972        -83.333854         -248.573120

end     6        -37.147972         83.333854         -251.430004

8    start     5       -133.167268         50.459054          142.286478

end     7        133.167268       -130.459054          219.549737

9    start     6        133.167268         89.540946          166.717132

end     8       -133.167268        -89.540946          191.446653

(NA= 165)

这道题结果和答案有点出入，用原来的pf程序算的结果为：

*****************************************************

*                                                     *

*    算例 21:31 2007-10-8                               *

*                                                     *

*****************************************************

The Input Data

The General Information

E           NM       NJ       NS       NLC

3.550E+07        9        8        6        1

The Information of Members

member    start    end           A                 I

1         1       2      2.800000E-01      1.143330E-02

2         1       3      1.600000E-01      2.133330E-03

3         2       4      1.600000E-01      2.133330E-03

4         3       4      2.800000E-01      1.143330E-02

5         3       5      1.600000E-01      2.133330E-03

6         4       6      1.600000E-01      2.133330E-03

7         5       6      2.800000E-01      1.143330E-02

8         5       7      1.600000E-01      2.133330E-03

9         6       8      1.600000E-01      2.133330E-03

The Joint Coordinates

joint             X                   Y

1             .000000           11.000000

2            6.000000           11.000000

3             .000000            7.500000

4            6.000000            7.500000

5             .000000            4.000000

6            6.000000            4.000000

7             .000000             .000000

8            6.000000             .000000

The Information of Supports

IS           VS

71           .000000

72           .000000

73           .000000

81           .000000

82           .000000

83           .000000

( NA=     165 )

( NW=     610 )

Loading Case    1

The Loadings at Joints

NLJ=     0

The Loadings at Members

NLM=     3

ILM    ITL             PV              DST

2      3           20.0000          3.500000

5      3           20.0000          3.500000

8      3           20.0000          4.000000

The Results of Calculation

The Joint Displacements

joint          u                 v                phi

1      1.347116E-02      1.297112E-04     -5.784199E-05

2      1.346143E-02     -1.297112E-04     -1.548442E-04

3      1.185913E-02      1.244502E-04     -3.540431E-04

4      1.183723E-02     -1.244502E-04     -3.389956E-04

5      7.643597E-03      9.375904E-05     -6.366158E-04

6      7.621174E-03     -9.375904E-05     -6.577319E-04

7      9.045905E-21      1.331378E-20     -1.929713E-20

8      8.954095E-21     -1.331378E-20     -1.915349E-20

The Terminal Forces

member      N(st)        Q(st)         M(st)        N(en)        Q(en)         M(en)

1       16.109       -8.538       -19.052      -16.109        8.538       -32.176

2       -8.538      -16.109        19.052        8.538      -53.891        47.067

3        8.538       16.109        32.176       -8.538      -16.109        24.206

4       36.284      -41.270      -124.827      -36.284       41.270      -122.791

5      -49.807       17.607        77.760       49.807      -87.607       106.365

6       49.807       52.393        98.585      -49.807      -52.393        84.791

7       37.148      -83.330      -248.563      -37.148       83.330      -251.420

8     -133.138       50.459       142.198      133.138     -130.459       219.638

9      133.138       89.541       166.629     -133.138      -89.541       191.535

( NA=     165 )

( NW=     622 )

其中节点竖直位移相差比较大，其它数据还比较接近。改写的不算成功。正在找bug。

附源程序：

/*用c改写的平面刚架静力分析程序pf(A program for analysis of plane frame)

应该还有错误，慎用

完成时间:2007.10.7*/

#define NULL 0

#include &lt;stdio.h&gt;

#include &lt;stdlib.h&gt;

#include &lt;math.h&gt;

float E;

int NM;

int NJ;

int NS;

int NLC;

int N;

int MAXBDW;

int NA;

int NLJ;

int NLM;

int *PN=&amp;N;

int *PNA=&amp;NA;

int *PMAXBDW=&amp;MAXBDW;

char CH;

FILE *IDFP,*OUTFP;

int W1[10000];

float W2[10000];

double W3[1000];


（未完待续）
<div class="tmpDiv"></div>
