--- 
layout: post
title: "\xE5\xB9\xB3\xE9\x9D\xA2\xE6\xA1\x81\xE6\x9E\xB6\xE6\x9C\xBA\xE5\x8A\xA8\xE5\x88\x86\xE6\x9E\x90\xE7\xA8\x8B\xE5\xBA\x8F"
categories: 
- "\xE6\x8B\xBE\xE9\x9B\xB6"
- "\xE6\xB5\x81\xE5\x85\xA5"
tags: 
- "\xE7\xA8\x8B\xE5\xBA\x8F"
- "\xE7\xBB\x93\xE6\x9E\x84\xE5\x8A\x9B\xE5\xAD\xA6"
status: publish
type: post
published: true
meta: 
  _edit_last: "1"
---
<p>     《计算结构力学——杆件结构》（钟万勰等著，高等教育出版社）一书的第三章第五节介绍了能处理大型复杂结构的机动分析算法。据此写了个简单的平面杆件机动分析程序，功能单一，不考虑界面。</p>
<p>
<pre lang="c" line="1">
/*一个简单的平面机动分析程序
 *作者：hmgle
 *时间：2007-10-25
 *版本：v1.0
 */
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

void f0(float *p,int a)
{
	int i;
	for(i=0;i<a;i++)
	{
		*(p+i)=0.0;
	}
}

int main()
{
	const int NULL = 0;
	int nj,nz,nm;   //nj:非地基结点数，nz:地基结点数，nm:约束杆件数
	int ist,ien;    //ist:始端,ien:末端
	float x[100],y[100];    //结点坐标
	float e[10000]; //基底向量
	float fz[100]; //内积向量
	float c[100];   //约束向量
	float ej[100]; //e中内积最大的向量
	int nf;    //自由度
	float d1,d2;    //约束方程系数
	char fname[13];     //输入文件名称
	FILE *fp;
	char ch;
	float x3,x1,x2;
	int i,j,k;
	float max; //最大内积
	int imax; //最大内积行号
    
	printf(“请输入数据文件名称:\n”);
	gets(fname);
	if((fp=fopen(fname,”r”))==NULL)
	{
		printf(“文件打开失败，请确认文件是否存在。\n”);
		exit (0);
	}
	for(i=0;i<5; )
	{
		ch=fgetc(fp);
		if(ch==’\n’)
		{
			i++;
		}
		putchar(ch);
	}
	fscanf(fp,”%d”,&nj);
	fscanf(fp,”%d”,&nz);
	fscanf(fp,”%d”,&nm);
	ch=fgetc(fp);
	
	for(i=0;i<(nj+nz);i++)
	{
		fscanf(fp,”%f”,x+i);
		fscanf(fp,”%f”,y+i);
		ch=fgetc(fp);
	}
	f0(e,(2*nj)*(2*nj));
	for(i=0;i<(2*nj);i++)
	{
		*(e+i*(2*nj)+i)=1.0;
	}
	nf=(2*nj);
	if(nf<=0)
	{
		printf(“数据错误,请检查.\n”);
		exit (0);
	}
	for(i=0;i<nm;i++)
	{
		d1=0.0;
		d2=0.0;
		fscanf(fp,”%d”,&ist);
		fscanf(fp,”%d”,&ien);
		ch=fgetc(fp);
		if(*(x+ien-1)-*(x+ist-1)>0.3)
		{
			d1=1.0;
		}
		if(*(y+ien-1)-*(y+ist-1)>0.3)
		{
			d2=1.0;
		}
		f0(c,(2*nj));
		*(c+2*(ist-1))=d1;
		*(c+2*(ist-1)+1)=d2;
		*(c+2*(ien-1))=-d1;
		*(c+2*(ien-1)+1)=-d2;
		f0(fz,nf);
		for(j=0;j<nf;j++)
		{
			for(k=0;k<(2*nj);k++)
			{
				*(fz+j)+=(*(e+j*(2*nj)+k)*(*(c+k)));
			}
		}
	
		/*判断新约束是否有效*/
		max=*fz;
		imax=0;
		for(j=1;j<nf;j++)
		{
			if(*(fz+j)>max)
			{
				max=*(fz+j);
				imax=j;
			}
		}
		for(j=0;j<(2*nj);++j)
		{
			*(ej+j)=*(e+imax*(2*nj)+j);
		}
		if(fabs((double) (max))>1e-3)
		{
			if(nf>=1)
			{
				nf–;
			}
		}
		if((nf==0)&&(nm-i>1))
		{
			printf(“体系为超静定结构,多余联系为%d\n”,nm-i-1);
			system(“pause”);
			exit (0);
		}
		if((nf==0)&&(nm-i==1))
		{
			printf(“体系为静定结构\n”);
			system(“pause”);
			exit (0);
		}
		if((nf>0)&&(nm-i==1))
		{
			printf(“体系几何可变\n”);
			system(“pause”);
			exit (0);
		}
	
		/*构造新基地向量*/
		for(j=0;j<nf;j++)
		{
			x1=0.;
			x2=0.;
			for(k=0;k<(2*nj);k++)
			{
				x1+=*(c+k)*(*(e+j*(2*nj)+k));
				x2+=*(c+k)*(*(ej+k));
			}
			x3=x1/x2;
			for(k=0;k<(2*nj);k++)
			{
				*(e+j*(2*nj)+k)-=x3*(*(ej+k));
			}
		}
	}
	fclose(fp); 
	system(“pause”);
	return (0);
}

</pre>
<p> </p>
